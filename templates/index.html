<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link href="../../static/style/index.css" rel="stylesheet">
    <link href="../../static/style/modal.css" rel="stylesheet">
    <link href="../../static/style/header.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-gH2yIJqKdNHPEq0n4Mqa/HGKIhSkIHeL5AyhkYV8i59U5AR6csBvApHHNl/vI1Bx" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.0/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-A3rJD856KowSb7dwlZdYEkO39Gagi7vIsF0jrRAoQmDKKtQBHUuLZ9AsSv4jD4Xa"
            crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
	integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
	crossorigin="anonymous"></script>
    <title>6Zipsa</title>
</head>
<body>

<!-- 헤더 -->
{% include "components/header.html" %}
<div class="main_container">
        <!-----------------left-sidebar-------------------->
        <div class="left-sidebar">

        </div>
        <!-----------------main content-------------------->
        <div class="main-content">

            <div class="story-gallery">
                <div class="story story1">
                    <img src="../images/shorts1.jpg">
                    <p>오늘의 인기글</p>
                </div>
                <div class="story story2">
                    <img src="../images/shorts1.jpg">
                    <p>주간 인기글</p>
                </div>
                <div class="story story3">
                    <img src="../images/shorts1.jpg">
                    <p>최신 글</p>
                </div>
            </div>
            <div class="write-post-container">
                <div class="user-profile">
                    <img src="../static/images/user.png">
                    <div>
                        <p>닉네임</p>
                        <small>Olly</small>
                    </div>
                </div>

                <div class="post-input-container">
                    <textarea rows="3" placeholder="오늘의 반려동물 자랑을 해보세요" id="post_area"></textarea>
                    <div class="add-post-links">
                        <a href="#"><img src="../static/images/user.png"> Photo</a>
                        <button type="button" class="btn btn-outline-info" id="post_button">작성</button>
                    </div>
                </div>
            </div>
            {% for i in range(0, len) %}
            <div class="post-container">
                <div class="user-profile">
                    <img src="../static/images/user.png">
                    <div>
                        <p>{{posts[i][1]}}</p>
                        <span>{{posts[i][3]}}</span>
                    </div>
                </div>
                <textarea class="form-control" id="{{posts[i][0]}}" readonly>{{posts[i][2]}}</textarea>
                {% if user_id == posts[i][1] %}
                <div class="input_group">
                    <button type="button" class="btn btn-outline-success" id="confirm_button{{posts[i][0]}}" onclick="modify_check()" hidden>확인</button>
                    <button type="button" name="{{posts[i][0]}}" class="btn btn-outline-info" id="modify_button">수정</button>
                    <button type="button" name="{{posts[i][0]}}" class="btn btn-outline-danger" id="delete_button">삭제</button>
                </div>
                {% endif %}
            </div>
            {% endfor %}


        </div>
        <!-----------------right-sidebar-------------------->
        <div class="right-sidebar">

        </div>

    </div>
{% block content %}
{% endblock %}
</body>
<script>
    let refresh = 0
    let post_id
    let text_input
    let confirm_button_id
    $('#post_button').click(function(e){
        let post_area = $('#post_area').val()
        let date = getFormatDate(new Date())
        $.ajax({
            type: 'POST',
            url: '/api/posts',
            data: {'post_give': post_area,'date_give': date},
            success: function(response){
            if (response['msg']=='success'){
                modalOpen('글 작성 완료!')
            }
            },
            error: function(response){

            }
        })
    })
    $('#modify_button').click(function(){
        post_id = $('#modify_button').attr('name')
        text_input = $('#'+post_id)
        text_input.attr('readonly', false)
        text_input.focus()
        confirm_button_id = '#confirm_button'+post_id
        $('#confirm_button'+post_id).attr('hidden', false)
    })
    function modify_check(){
        let date = getFormatDate(new Date())
        $.ajax({
            type: 'PUT',
            url: '/api/posts',
            data: {'id_give': post_id, 'post_give': text_input.val(),'date_give': date},
            success: function(response){
            if (response['msg']=='success'){
                refresh = 1
                modalOpen('글 수정 완료!')
            }
            },
            error: function(response){

            }
        })
    }
    $('#search_input').keyup(function(e){
        if(e.keyCode == 13){
            $('#search_form').submit()
        }
    })
</script>
<script type="text/javascript"src="../../static/js/date.js"></script>
<script type="text/javascript" src="../../static/js/modal.js"></script>
</html>